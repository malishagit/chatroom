
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Chatroom Index</title>
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.3.min.js"></script>

</script>
    <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type = "text/javascript">
    	// var socket = io.connect("http://localhost:8000");
    	var socket = io();
    	$(document).ready(function(){
    		var socket = io.connect();
    		var current_user;
    		var new_user = function(){
    			var name = prompt("Please enter your name to chat");
    		
    			socket.emit('got_a_new_user',{user:name});
    		}
    		new_user();
    		socket.on('existing_user',function(data){
    			$('#error').html(data.error);
    			// console.log("This comes from an existing user",data);
    			new_user();
    		})
    		socket.on('load_messages',function(data){
    			$('#error').html(" ");   //resetting the error message
    			current_user = data.current_user;
    			var messages = data.messages;
    			var messages_thread = "";

    			for (var i = 0;i <messages.length;i++){
    				messages_thread += "<p>" + messages[i].name +":"+messages[i].message + "</p>";
    			}
    			$("#message_board").append(messages_thread);
    		})
    		$("#new_message").submit(function(){
    			socket.emit('new_message',{message:$("#message").val(),user:current_user })


    			return false;
    		})

    		socket.on("post_new_message",function(data){
    			$("#message_board").append("<p>"+data.user + ":"+data.new_message + "<p>")

    		});
    	});
    </script>
</head>
<body>
	<div id="container">
		<div id="error"></div>
	
		<h2>Conversation Board</h2>
		<div id="message_board">
			
		</div>
		<form id="new_message">
			<input type="text" id="message"placeholder="enter your message here">
			<input type="submit" value="send">
		</form>
		
		
	</div>
	
</body>
</html>